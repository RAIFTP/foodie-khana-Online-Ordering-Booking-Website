<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Order & Booking - Kunsimol</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="order.css" />
</head>
<!-- Kunsi AI Assistant -->
<div id="kunsiChat" class="kunsi-chat">
  <div class="chat-header">
    <span>Kunsi ü§ñ</span>
    <button id="closeKunsi">√ó</button>
  </div>
  <div class="chat-body" id="chatBody"></div>
  <div class="chat-footer">
    <input type="text" id="kunsiInput" placeholder="Ask Kunsi about our food or restaurant...">
    <button id="sendKunsi">Send</button>
  </div>
</div>

<button id="openKunsi" class="kunsi-btn">üí¨ Ask Kunsi</button>

<body>

  <header>
    <h1>Order & Booking - Kunsimol</h1>
    <p>Enjoy delicious food delivered to your door or book a special meal with us!</p>
    <button id="signInBtn">Sign In</button>
  </header>

  <div class="container">

    <!-- Cart Summary Section -->
    <section id="cartSummarySection">
      <h2>üõí Your Order Summary</h2>
      <div class="cart-summary">
        <div id="cartItemsList" class="cart-items-display">
          <!-- Cart items will be populated here -->
        </div>
        <div class="cart-total-display">
          <strong>Total: ‚Çπ<span id="cartTotalDisplay">0</span></strong>
        </div>
        <div class="delivery-info">
          <p><strong>Delivery:</strong> <span id="deliveryCharge">Free delivery above ‚Çπ500, otherwise ‚Çπ30</span></p>
          <p><strong>Final Total:</strong> ‚Çπ<span id="finalTotal">0</span></p>
        </div>
      </div>
    </section>



    <section>
      <h2>üöö Delivery Details</h2>
      <div class="info-box">
        <p>We deliver fresh, hot meals within 45 minutes in your area! Delivery is available from 10AM - 10PM every day.</p>
        <p><strong>Charges:</strong> Free delivery above ‚Çπ500. Else ‚Çπ30 only.</p>
      </div>
    </section>

    <section>
      <h2>üìÖ Book a Table / Event</h2>
      <form id="bookingForm">
        <input type="text" id="name" placeholder="Your Name" required>
        <input type="email" id="email" placeholder="Email Address" required>
        <input type="tel" id="phone" placeholder="Phone Number" required>
        <label for="date" id="dateLabel">Date</label>
        <input type="date" id="date" required placeholder="Select date" aria-labelledby="dateLabel">
        <label for="time" id="timeLabel">Time</label>
        <input type="time" id="time" required placeholder="Select time" aria-labelledby="timeLabel">

        <!-- Food Item Dropdown -->
        <label for="foodItem" id="foodItemLabel">Food Item</label>
        <select id="foodItem" required aria-labelledby="foodItemLabel">
          <option value="">Select Food Item</option>
          <option value="Chicken Biriyani">Chicken Biriyani</option>
          <option value="Porotta & Beef">Porotta & Beef</option>
          <option value="Veg Meals">Veg Meals</option>
          <option value="Shawarma Roll">Shawarma Roll</option>
          <option value="Shawarma Plate">Shawarma Plate</option>
          <option value="Shawaya">Shawaya</option>
          <option value="Kunsimol Fried Chicken">Kunsimol Fried Chicken</option>
          <option value="Kunsi Special">Kunsi Special</option>
          <option value="Ali Ka Dhosth Tea">Ali Ka Dhosth Tea</option>
          <option value="Lava Biriyani">Lava Biriyani</option>
          <option value="Malabar Porotta">Malabar Porotta</option>
          <option value="Puttum Kadala">Puttum Kadala</option>
          <option value="Egg Roast">Egg Roast</option>
          <option value="Appam & Stew">Appam & Stew</option>
          <option value="Fish Curry Meals">Fish Curry Meals</option>
        </select>

        <!-- Price Input -->
  <input type="number" id="price" placeholder="Price (‚Çπ)" min="0" required readonly>

        <textarea id="requests" placeholder="Any special requests..." rows="4"></textarea>
        <button type="submit">Submit Booking</button>
      </form>
    </section>

    <section>
      <h2>‚òï About Our Food</h2>
      <div class="info-box">
        <p>At Kunsimol, we handpick local spices, use organic vegetables, and ensure hygiene from kitchen to delivery. Our signature dishes like Lava Biriyani, Shawaya, and Kunsi Special are made with love and tradition.</p>
      </div>
    </section>

    <section>
      <h2>‚òéÔ∏è Contact Us</h2>
      <div class="info-box">
        <p>Email: <a href="mailto:kunsimol6037@example.com">kunsimol6037@example.com</a></p>
        <p>Phone: <a href="tel:+919998888778">+91 999 888 8778</a></p>
        <p>Instagram: <a href="https://instagram.com/kunsimol" target="_blank" rel="noopener">@kunsimol</a></p>
        <p>Location: Palakkad, Kerala, India</p>
      </div>
    </section>

  </div>

  <footer>
    <p>&copy; 2025 Kunsimol. All rights reserved.</p>
  </footer>

  <!-- Sign-In Modal -->
  <div id="signInModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Sign In</h2>
      <form id="signInForm">
        <input type="email" placeholder="Email" required>
        <input type="password" placeholder="Password" required>
        <button type="submit">Sign In</button>
      </form>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    // Sign-in Modal Logic
    const signInBtn = document.getElementById('signInBtn');
    const modal = document.getElementById('signInModal');
    const closeBtn = document.querySelector('.modal .close');

    console.log('Sign-in elements:', { signInBtn, modal, closeBtn }); // Debug log

    if (signInBtn) {
      signInBtn.onclick = function () {
        console.log('Sign-in button clicked'); // Debug log
        if (modal) {
          modal.style.display = "block";
        } else {
          console.error('Modal not found!');
        }
      }
    } else {
      console.error('Sign-in button not found!');
    }

    if (closeBtn) {
      closeBtn.onclick = function () {
        console.log('Close button clicked'); // Debug log
        if (modal) {
          modal.style.display = "none";
        }
      }
    } else {
      console.error('Close button not found!');
    }

    window.onclick = function (e) {
      if (e.target === modal) {
        console.log('Clicked outside modal'); // Debug log
        if (modal) {
          modal.style.display = "none";
        }
      }
    }

    const signInForm = document.getElementById('signInForm');
    if (signInForm) {
      signInForm.onsubmit = function (e) {
        e.preventDefault();
        console.log('Sign-in form submitted'); // Debug log
        
        const emailInput = e.target.querySelector('input[type="email"]');
        const passwordInput = e.target.querySelector('input[type="password"]');
        
        if (!emailInput || !passwordInput) {
          console.error('Email or password input not found!');
          alert('Form error! Please refresh the page.');
          return;
        }
        
        const email = emailInput.value.trim();
        const password = passwordInput.value;
        
        console.log('Email:', email, 'Password:', password); // Debug log
        
        if (email === "raif@gmail.com" && password === "raif") {
          alert("Welcome Admin!");
          console.log('Redirecting to admin.html'); // Debug log
          window.location.href = "admin.html"; 
        } else {
          alert("Invalid credentials. Please try again.");
          console.log('Invalid credentials entered'); // Debug log
        }
        
        if (modal) {
          modal.style.display = "none";
        }
      }
    } else {
      console.error('Sign-in form not found!');
    }

    // Booking Form Logic (Store in localStorage)
    const bookingForm = document.getElementById('bookingForm');
    if (bookingForm) {
      bookingForm.addEventListener('submit', function(e) {
        e.preventDefault();
        console.log('Booking form submitted'); // Debug log

        // Check if this is a cart order or single item order
        const orderDetails = getQueryParam('order');
        const cartTotal = getQueryParam('total');
        
        console.log('Order details:', orderDetails, 'Cart total:', cartTotal); // Debug log
        
        // Get form elements
        const nameInput = document.getElementById('name');
        const emailInput = document.getElementById('email');
        const phoneInput = document.getElementById('phone');
        const dateInput = document.getElementById('date');
        const timeInput = document.getElementById('time');
        const requestsInput = document.getElementById('requests');
        
        if (!nameInput || !emailInput || !phoneInput || !dateInput || !timeInput) {
          console.error('Required form elements not found!');
          alert('Form error! Please refresh the page.');
          return;
        }
        
        const order = {
          name: nameInput.value,
          email: emailInput.value,
          phone: phoneInput.value,
          date: dateInput.value,
          time: timeInput.value,
          requests: requestsInput ? requestsInput.value : '',
          createdAt: new Date().toLocaleString()
        };

        console.log('Basic order data:', order); // Debug log
        
        // Validate required fields
        if (!order.name || !order.email || !order.phone || !order.date || !order.time) {
          alert('Please fill in all required fields!');
          console.log('Required field validation failed'); // Debug log
          return;
        }

        // Add cart or single item data
        if (orderDetails && cartTotal) {
          // Cart order
          order.orderType = 'cart';
          order.items = orderDetails;
          order.cartTotal = parseInt(cartTotal);
          order.deliveryCharge = parseInt(cartTotal) >= 500 ? 0 : 30;
          order.finalTotal = order.cartTotal + order.deliveryCharge;
          console.log('Cart order created:', order); // Debug log
        } else {
          // Single item order
          const foodSelect = document.getElementById('foodItem');
          const priceInput = document.getElementById('price');
          
          order.orderType = 'single';
          order.foodItem = foodSelect ? foodSelect.value : '';
          order.price = priceInput ? priceInput.value : '';
          order.finalTotal = parseInt(order.price || 0);
          
          console.log('Single order created:', order); // Debug log
          
          // Validate that food item is selected for single orders
          if (!order.foodItem && !orderDetails) {
            alert('Please select a food item!');
            console.log('Food item validation failed'); // Debug log
            return;
          }
        }

        try {
          let orders = JSON.parse(localStorage.getItem('orders')) || [];
          orders.push(order);
          localStorage.setItem('orders', JSON.stringify(orders));
          
          console.log('Order saved to localStorage:', orders); // Debug log

          alert("Your booking has been submitted!");
          this.reset();
          
          // Hide cart summary after successful submission
          const cartSection = document.getElementById('cartSummarySection');
          if (cartSection) {
            cartSection.classList.remove('show');
          }
        } catch (error) {
          console.error('Error saving order:', error);
          alert('Error saving your order. Please try again.');
        }
      });
    } else {
      console.error('Booking form not found!');
    }

    // Pre-select food item if passed in URL
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    // Cart functionality - parse cart data from URL
    function displayCartSummary() {
      const orderDetails = getQueryParam('order');
      const total = getQueryParam('total');
      
      if (orderDetails && total) {
        const cartSection = document.getElementById('cartSummarySection');
        const cartItemsList = document.getElementById('cartItemsList');
        const cartTotalDisplay = document.getElementById('cartTotalDisplay');
        const finalTotalDisplay = document.getElementById('finalTotal');
        
        if (cartSection && cartItemsList && cartTotalDisplay && finalTotalDisplay) {
          // Show cart summary section
          cartSection.classList.add('show');
          
          // Parse and display cart items
          const items = orderDetails.split(', ');
          cartItemsList.innerHTML = items.map(item => `
            <div class="cart-item-display">
              <span>${item}</span>
            </div>
          `).join('');
          
          // Display totals
          const cartTotal = parseInt(total);
          cartTotalDisplay.textContent = cartTotal;
          
          // Calculate delivery charge
          const deliveryCharge = cartTotal >= 500 ? 0 : 30;
          const finalTotal = cartTotal + deliveryCharge;
          finalTotalDisplay.textContent = finalTotal;
          
          // Update delivery info
          const deliveryChargeSpan = document.getElementById('deliveryCharge');
          if (deliveryChargeSpan) {
            deliveryChargeSpan.textContent = cartTotal >= 500 ? 'Free delivery!' : 'Delivery charge: ‚Çπ30';
          }
          
          // Hide food item selection in booking form and show cart info instead
          const foodSelect = document.getElementById('foodItem');
          const priceInput = document.getElementById('price');
          const foodLabel = document.querySelector('label[for="foodItem"]');
          if (foodSelect && priceInput) {
            foodSelect.style.display = 'none';
            priceInput.style.display = 'none';
            if (foodLabel) foodLabel.style.display = 'none';
            
            // Remove required attribute when coming from cart
            foodSelect.removeAttribute('required');
            
            // Pre-fill with cart data
            priceInput.value = finalTotal;
          }
        }
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      // Display cart summary if coming from checkout
      displayCartSummary();
      
      setTimeout(function() {
        const foodItem = getQueryParam('item');
        // Fixed prices for each food item
        const foodPrices = {
          "Chicken Biriyani": 150,
          "Porotta & Beef": 180,
          "Veg Meals": 120,
          "Shawarma Roll": 90,
          "Shawarma Plate": 140,
          "Shawaya": 200,
          "Kunsimol Fried Chicken": 160,
          "Kunsi Special": 220,
          "Ali Ka Dhosth Tea": 40,
          "Lava Biriyani": 250,
          "Malabar Porotta": 60,
          "Puttum Kadala": 80,
          "Egg Roast": 70,
          "Appam & Stew": 90,
          "Fish Curry Meals": 180
        };

        const foodSelect = document.getElementById('foodItem');
        const priceInput = document.getElementById('price');
        console.log('foodSelect:', foodSelect);
        console.log('priceInput:', priceInput);
        console.log('foodItem from URL:', foodItem);
        function setPriceForFood(food) {
          console.log('Setting price for food:', food, 'price:', foodPrices[food]);
          if (foodPrices[food]) {
            priceInput.value = foodPrices[food];
          } else {
            priceInput.value = '';
          }
        }
        if (foodSelect && priceInput) {
          // Always set price on page load
          if (foodItem && foodPrices[foodItem]) {
            foodSelect.value = foodItem;
            setPriceForFood(foodItem);
          } else {
            setPriceForFood(foodSelect.value);
          }
          // Always set price on change
          foodSelect.addEventListener('change', function() {
            setPriceForFood(foodSelect.value);
          });
        } else {
          console.log('foodSelect or priceInput not found');
        }
      }, 0);
    });
    // Kunsi Chatbot Logic
const openBtn = document.getElementById('openKunsi');
const closeKunsiBtn = document.getElementById('closeKunsi');
const chatBox = document.getElementById('kunsiChat');
const chatBody = document.getElementById('chatBody');
const sendBtn = document.getElementById('sendKunsi');
const input = document.getElementById('kunsiInput');

openBtn.onclick = () => { chatBox.style.display = 'flex'; };
closeKunsiBtn.onclick = () => { chatBox.style.display = 'none'; };

function appendMessage(msg, sender) {
  const div = document.createElement('div');
  div.textContent = msg;
  div.className = sender === 'user' ? 'user-msg' : 'kunsi-msg';
  chatBody.appendChild(div);
  chatBody.scrollTop = chatBody.scrollHeight;
}

// Simple AI response logic
function getKunsiResponse(message) {
  const msg = message.toLowerCase();
  if (msg.includes('hello') || msg.includes('hi')) return "Hello! I'm Kunsi ü§ñ, your assistant. How can I help you today?";
  if (msg.includes('food') || msg.includes('menu')) return "We have Chicken Biriyani, Porotta & Beef, Veg Meals, Shawarma, Shawaya, Kunsimol Fried Chicken, Kunsi Special, and Ali Ka Dhosth Tea. üçΩÔ∏è";
  if (msg.includes('location') || msg.includes('where')) return "We are located in Palakkad, Kerala, India. üìç";
  if (msg.includes('contact') || msg.includes('phone') || msg.includes('email')) return "You can email us at kunsimol6037@example.com or call +91 999 888 8778.";
  if (msg.includes('about')) return "Kunsimol Foods serves authentic Kerala cuisine made with love and fresh ingredients!";
  return "I'm sorry, I didn't understand that. Ask me about our menu, location, or contact info!";
}

sendBtn.onclick = () => {
  const msg = input.value.trim();
  if (!msg) return;
  appendMessage(msg, 'user');
  input.value = '';
  setTimeout(() => {
    appendMessage(getKunsiResponse(msg), 'kunsi');
  }, 500);
};

// Allow pressing Enter to send message
input.addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    sendBtn.click();
    e.preventDefault();
  }
});

  </script>

</body>
</html>
